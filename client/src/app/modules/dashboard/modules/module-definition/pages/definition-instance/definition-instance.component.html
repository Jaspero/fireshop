<form *ngIf="form$ | async as form" [formGroup]="form" [ngSwitch]="currentState">
  <mat-toolbar role="heading" color="primary" class="sticky-header">
    <span class="of-x-auto of-y-hidden" *ngSwitchCase="viewState.Edit">{{form.get('name').value}}</span>
    <span class="of-x-auto of-y-hidden" *ngSwitchCase="viewState.New">{{'GENERAL.NEW' | transloco}} {{'LAYOUT.MODULES' | transloco}}</span>
    <span class="of-x-auto of-y-hidden" *ngSwitchCase="viewState.Copy">Copy of {{form.get('name').value}}</span>
    <div class="flex-1"></div>
    <a mat-button (click)="back()">{{'GENERAL.CANCEL' | transloco}}</a>&nbsp;
    <button
      mat-flat-button
      [disabled]="form.invalid"
      [jpLoadClick]="save(form)">
      {{'GENERAL.SAVE' | transloco}}
    </button>
  </mat-toolbar>

  <section class="grid" *ngSwitchCase="viewState.Edit">
    <div class="col-12">
      <mat-card>
        <div class="flex ai-center">
          <button mat-button (click)="duplicate(form)">
            <mat-icon>filter_none</mat-icon>
            <span>&nbsp;Duplicate</span>
          </button>
          <div class="flex-1"></div>
        </div>
      </mat-card>
    </div>
  </section>

  <section class="grid fw-rev">
    <div class="col-8 col-s-12">
      <mat-card>
        <mat-card-header>
          <div class="flex ai-center h-full w-full jc-between">
            <h1>Setup</h1>
            <div>
              <button mat-icon-button matTooltip="Import module" (click)="openSelectFile()"><mat-icon>settings_input_svideo</mat-icon></button>
              <button mat-icon-button matTooltip="Add Snippet" (click)="openSnippetSelection(form)"><mat-icon>add</mat-icon></button>
            </div>
          </div>
        </mat-card-header>

        <mat-card-content>
          <mat-tab-group>
            <mat-tab label="Schema">
              <jms-json-editor formControlName="schema" [options]="schemaOptions"></jms-json-editor>
            </mat-tab>
            <mat-tab label="Layout">
              <jms-json-editor formControlName="layout" [options]="layoutOptions"></jms-json-editor>
            </mat-tab>
            <mat-tab label="Definitions">
              <jms-json-editor formControlName="definitions" [options]="definitionsOptions"></jms-json-editor>
            </mat-tab>
            <mat-tab label="Metadata">
              <jms-json-editor formControlName="metadata"></jms-json-editor>
            </mat-tab>
          </mat-tab-group>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="col-4 col-s-12">
      <mat-card>
        <mat-card-header>
          <h1>Info</h1>
        </mat-card-header>

        <mat-card-content>
          <mat-form-field class="w-full" [class.mat-form-field-has-hint]="currentState !== viewState.Edit">
            <mat-label>ID</mat-label>
            <input matInput formControlName="id">
            <mat-hint *ngIf="currentState !== viewState.Edit">Autogenerated if left empty.</mat-hint>
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Name</mat-label>
            <input matInput formControlName="name">
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description"></textarea>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card class="m-t-m">
        <mat-card-header>
          <h1>Authorization</h1>
        </mat-card-header>

        <mat-card-content formGroupName="authorization">
          <mat-form-field class="w-full">
            <mat-label>Write</mat-label>
            <mat-select [multiple]="true" formControlName="write">
              <mat-option *ngFor="let role of roles$ | async" [value]="role.id">
                {{role.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Read</mat-label>
            <mat-select [multiple]="true" formControlName="read">
              <mat-option *ngFor="let role of roles$ | async" [value]="role.id">
                {{role.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </mat-card-content>
      </mat-card>
    </div>
  </section>
</form>

<input type="file" hidden #file (change)="selectFile($event)">
